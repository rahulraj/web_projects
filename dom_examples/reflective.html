<!DOCTYPE html>

<head>
	<title>reflective DOM example</title>

	<script>
		// This script creates a 'meta' structure that parallels the structure of the page
		// and is inserted at its top. When you move the mouse over an element in this structure
		// the corresponding element is highlighted in the main page.
		
		// The code in this script section can be cut and pasted into the browser console 
		// so that it can be applied to arbitrary web pages. It can also be minified and used
		// as a bookmarklet in some browsers (eg Chrome); others (eg, Safari) won't allow 
		// bookmarklets to perform all these commands. I'm not sure why.
	

        // return an element corresponding to elt
        // with tag div if elt is block, else span         
		// and whose content is the tag name of elt
		function make_matching_element (elt) {
			// if elt is inline return inline, else block
			// note currentStyle can be null
			var cStyle = elt.currentStyle || window.getComputedStyle(elt, "");
			var tag = (cStyle.display === "inline") ? "span" : "div";
			var meta_elt = document.createElement(tag);			
			meta_elt.textContent = elt.tagName;

			meta_elt.style.borderColor = "black";
			meta_elt.style.borderStyle = "solid";
			meta_elt.style.borderWidth = "1px";
			meta_elt.style.padding = "5px";
			meta_elt.style.margin = "5px";
			meta_elt.style.float = "left";
			return meta_elt;
        }

		// return a new scrolling element that contains child
        function make_scroll_box (child) {
			var box = document.createElement("div");
			box.style.height = "120px";
			box.style.width = "100%";
			box.style.overflow = "scroll";
			box.appendChild(child)
            return box;
        }

		// make meta element for elt and append as child of meta_parent
		// setup listeners so moving mouse over meta element highlights corresponding element
		function make_meta(elt, meta_parent) {
			var meta_elt = make_matching_element(elt);			
			var original_color = elt.style.backgroundColor;
			meta_elt.addEventListener("mouseover", 
				function (event) {
					event.stopPropagation();
					elt.style.backgroundColor = "yellow";});
			meta_elt.addEventListener("mouseout", 
				function () {
				    elt.style.backgroundColor = original_color;});
			meta_parent.appendChild (meta_elt);
			return meta_elt;
		}
		
		// make meta structure for elt and its children and append as child of meta_parent
		function walk(elt, meta_parent) {
			var meta_elt = make_meta(elt, meta_parent);
			var child = elt.firstElementChild;
			while (child) {
		    	walk(child, meta_elt);
				child = child.nextElementSibling;
	        }			
		}

		// make meta structure for body and insert at top of body
		function walk_body() {
			var body = document.body;
			var fragment = document.createDocumentFragment();
			walk(body, fragment);
			body.insertBefore(make_scroll_box(fragment), body.firstChild);
		}
		
		window.onload = walk_body;
		
	</script>
</head>

<body>
	<h1>Heading</h1>
	
	<p>Here is a list:
	<ol>
		<li>First item of list with a <a href="http://nytimes.com">link</a>
		<li>Second item of list;
		<li>Third item of list;
	</ol>
</body>
</html>
