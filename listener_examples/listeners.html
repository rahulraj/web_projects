<html>
<head>
    <title>Examples of Simple Listeners</title>
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.6.1/jquery.min.js"></script>
    
    <script>
    $(function () {
        // invoke f(i) with i ranging over from..to
        var fromTo = function (from, to, f) {
        	for (var i = from; i <= to; i = i+1) f(i);
        	};
        
        // simple demo of listeners that read and write global state
        var ds = $('#dollars');
        var es = $('#euros');
        var EUROS_PER_DOLLAR = 0.755;
        var convert = function (x, rate) {return (x * rate).toFixed(2);};
        ds.change(function () {es.val(convert(ds.val(), EUROS_PER_DOLLAR));});
        es.change(function () {ds.val(convert(es.val(), 1/EUROS_PER_DOLLAR));});
        
        // using event object
        $(document).bind('mousemove',function(e){ 
                $('#log').text("x: " + e.pageX + ", y: " + e.pageY)});
        
        // simple demo of listener that accesses local var in closure
        var b = $('#button');
        b.click(
            (function (i) {
                return (function () {i += 1; $(this).text("Pressed " + i + " times");});}) (0));
        
        // simple demo of listener attached to element created programmatically
        fromTo(0,3, function (i) {
            var bi = $("<button>"); bi.text(i);
            $('body').append(bi);
            bi.click(function () {b.text("Pressed " + i);});
        });
        
        // puzzle for students: why doesn't this work?
		// causes display of second set of buttons
		// but clicking them gives incorrect report
        for (var i = 0; i <= 3; i += 1) {
            var bi = $("<button>"); bi.text(i);
            $('body').append(bi);
            bi.click(function () {b.text("Pressed " + i);});
        };
    })
    </script>
</head>
<body>
Dollars:<input id=dollars></input><br>
Euros:<input id=euros></input>
<p>
<button id=button>Press me!</button>
<p>
<div id=log></div><br>
<p>
</body>
</html>